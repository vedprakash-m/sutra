<!doctype html>
<html>
  <head>
    <title>Sutra Admin Test</title>
    <style>
      body {
        font-family: Arial, sans-serif;
        margin: 20px;
      }
      .step {
        margin: 20px 0;
        padding: 15px;
        border: 1px solid #ddd;
      }
      .success {
        background: #d4edda;
      }
      .error {
        background: #f8d7da;
      }
      button {
        padding: 10px 20px;
        margin: 5px;
      }
      pre {
        background: #f8f9fa;
        padding: 10px;
        overflow-x: auto;
      }
    </style>
  </head>
  <body>
    <h1>Sutra Frontend-Backend Integration Test</h1>

    <div class="step">
      <h3>Step 1: Setup Demo Admin User</h3>
      <button onclick="setupAdmin()">Setup Admin User</button>
      <button onclick="checkLocalStorage()">Check Current Setup</button>
      <div id="setup-result"></div>
    </div>

    <div class="step">
      <h3>Step 2: Test API Endpoints</h3>
      <button onclick="testAuth()">Test Authentication</button>
      <button onclick="testCollections()">Test Collections</button>
      <button onclick="testPrompts()">Test Prompts</button>
      <button onclick="testIntegrations()">Test Integrations</button>
      <div id="api-results"></div>
    </div>

    <div class="step">
      <h3>Step 3: Go to Main App</h3>
      <p>
        After setting up admin user, go to:
        <a href="http://localhost:3001" target="_blank"
          >http://localhost:3001</a
        >
      </p>
      <p>You should see admin functionality enabled.</p>
    </div>

    <script>
      function setupAdmin() {
        const demoUser = {
          id: "vedprakash-admin-001",
          email: "vedprakash.m@outlook.com",
          name: "Vedprakash Mishra",
          role: "admin",
        };

        localStorage.setItem("sutra_demo_role", "admin");
        localStorage.setItem("sutra_demo_user", JSON.stringify(demoUser));

        document.getElementById("setup-result").innerHTML =
          '<div class="success">✅ Admin user setup complete! Demo user: ' +
          demoUser.email +
          " (role: " +
          demoUser.role +
          ")</div>";
      }

      function checkLocalStorage() {
        const role = localStorage.getItem("sutra_demo_role");
        const user = localStorage.getItem("sutra_demo_user");

        document.getElementById("setup-result").innerHTML = `
                <div>
                    <p><strong>Demo Role:</strong> ${role || "Not set"}</p>
                    <p><strong>Demo User:</strong> ${user || "Not set"}</p>
                </div>
            `;
      }

      async function testAuth() {
        try {
          const response = await fetch("/api/getroles");
          const data = await response.json();
          updateResults("auth", `✅ Auth: ${JSON.stringify(data)}`);
        } catch (error) {
          updateResults("auth", `❌ Auth failed: ${error.message}`);
        }
      }

      async function testCollections() {
        try {
          const response = await fetch("/api/collections");
          const data = await response.json();
          updateResults(
            "collections",
            `✅ Collections: Found ${data.collections?.length || 0} items`,
          );
        } catch (error) {
          updateResults(
            "collections",
            `❌ Collections failed: ${error.message}`,
          );
        }
      }

      async function testPrompts() {
        try {
          const response = await fetch("/api/prompts");
          const data = await response.json();
          updateResults(
            "prompts",
            `✅ Prompts: Found ${data.prompts?.length || 0} items`,
          );
        } catch (error) {
          updateResults("prompts", `❌ Prompts failed: ${error.message}`);
        }
      }

      async function testIntegrations() {
        try {
          const response = await fetch("/api/integrations/llm");
          if (response.ok) {
            const data = await response.json();
            updateResults(
              "integrations",
              `✅ Integrations: ${JSON.stringify(data)}`,
            );
          } else {
            updateResults(
              "integrations",
              `❌ Integrations failed: ${response.status} ${response.statusText}`,
            );
          }
        } catch (error) {
          updateResults(
            "integrations",
            `❌ Integrations failed: ${error.message}`,
          );
        }
      }

      function updateResults(test, message) {
        const resultsDiv = document.getElementById("api-results");
        const existing = resultsDiv.innerHTML;
        resultsDiv.innerHTML = existing + "<div>" + message + "</div>";
      }
    </script>
  </body>
</html>
